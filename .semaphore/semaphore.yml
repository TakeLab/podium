version: v1.0
name: CI tests for TakeLab podium

agent:
  machine:
    type: e1-standard-2

  containers:
    - name: main
      image: semaphoreci/python:3.6.2

blocks:
  - name: setup environment and run tests
    task:
      jobs:
        - name: setup env and run pytest
          commands:
            - checkout
            - python -m venv venv
            - source venv/bin/activate
            - pip install --upgrade pip
            - pip install .[tests]
            - pytest -sv tests

  - name: check code quality
    task:
      jobs:
        - name: check black isort flake8 compliance
          commands:
            - checkout
            - sudo pip install .[quality]
            - black --check --line-length 90 --target-version py36 podium tests examples
            - isort --check-only podium tests examples
            - flake8 podium tests examples
  
  - name: build docs
    task:
      jobs:
        - name: build docs with sphinx
          commands:
            - checkout
            - sudo pip install .[docs]
            - cd docs && make html SPHINXOPTS="-W"
            - artifact push job docs/build
# add `deploy docs` block on stable relase
